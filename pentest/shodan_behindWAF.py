import shodan
import sys

# Initialize Shodan API
API_KEY = 'YOUR_SHODAN_API_KEY'  # Replace with your actual Shodan API key
api = shodan.Shodan(API_KEY)

# Read domain names from a file
def read_domains(file_path):
    with open(file_path, 'r') as file:
        domains = [line.strip() for line in file if line.strip()]
    return domains

# Search historical data for each domain
def search_historical_data(domain):
    try:
        print(f"\n[+] Searching historical data for domain: {domain}")
        results = api.search(f"ssl.cert.subject.CN:{domain}")
        
        if results['total'] > 0:
            for result in results['matches']:
                ip = result.get('ip_str', 'N/A')
                ssl_data = result.get('ssl', {}).get('cert', {})
                issued_to = ssl_data.get('subject', {}).get('CN', 'N/A')
                print(f"IP Address: {ip} - Issued to: {issued_to}")
        else:
            print(f"No historical data found for {domain}")
    except shodan.APIError as e:
        print(f"Error: {e}")

# Main function
if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python shodan_historical_search.py <domains.txt>")
        sys.exit(1)

    domains = read_domains(sys.argv[1])
    for domain in domains:
        search_historical_data(domain)
