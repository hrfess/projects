import requests
import sys

# Initialize SecurityTrails API
API_KEY = 'YOUR_SECURITYTRAILS_API_KEY'  # Replace with your actual SecurityTrails API key
API_URL = "https://api.securitytrails.com/v1/domain/{domain}/historical/dns/a"

# Read domain names from a file
def read_domains(file_path):
    with open(file_path, 'r') as file:
        domains = [line.strip() for line in file if line.strip()]
    return domains

# Search historical IP data for each domain
def search_historical_data(domain):
    print(f"\n[+] Searching historical data for domain: {domain}")
    headers = {
        'APIKEY': API_KEY
    }
    response = requests.get(API_URL.format(domain=domain), headers=headers)

    if response.status_code == 200:
        data = response.json()
        for record in data.get('records', []):
            for value in record.get('values', []):
                print(f"IP Address: {value['ip']} - First Seen: {record['first_seen']} - Last Seen: {record['last_seen']}")
    elif response.status_code == 403:
        print("[-] Access Forbidden. Check your API key or subscription plan.")
    elif response.status_code == 404:
        print(f"[-] No historical data found for {domain}")
    else:
        print(f"[-] Error: {response.status_code} - {response.text}")

# Main function
if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python securitytrails_search.py <domains.txt>")
        sys.exit(1)

    domains = read_domains(sys.argv[1])
    for domain in domains:
        search_historical_data(domain)
